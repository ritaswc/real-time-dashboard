/*
 * artDialog iframeTools
 * Date: 2011-11-25 13:54
 * http://code.google.com/p/artdialog/
 * (c) 2009-2011 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */
(function(a,m,k,l){var h,f,j,b="@ARTDIALOG.DATA",d="@ARTDIALOG.OPEN",e="@ARTDIALOG.OPENER",i=m.name=m.name||"@ARTDIALOG.WINNAME"+ +new Date,c=m.VBArray&&!m.XMLHttpRequest;a(function(){!m.jQuery&&document.compatMode==="BackCompat"&&alert('artDialog Error: document.compatMode === "BackCompat"')});var g=k.top=function(){var o=m,n=function(r){try{var p=m[r].document;p.getElementsByTagName}catch(q){return false}return m[r].artDialog&&p.getElementsByTagName("frameset").length===0};if(n("top")){o=m.top}else{if(n("parent")){o=m.parent}}return o}();k.parent=g;h=g.artDialog;j=function(){return h.defaults.zIndex};k.data=function(o,q){var p=k.top,n=p[b]||{};p[b]=n;if(q!==l){n[o]=q}else{return n[o]}return n};k.removeData=function(o){var n=k.top[b];if(n&&n[o]){delete n[o]}};k.through=f=function(){var n=h.apply(this,arguments);if(g!==m){k.list[n.config.id]=n}return n};g!==m&&a(m).bind("unload",function(){var p=k.list,n;for(var o in p){if(p[o]){n=p[o].config;if(n){n.duration=0}p[o].close()}}});k.open=function(G,C,s){C=C||{};var r,u,n,q,x,p,o,z,w,E=k.top,y="position:absolute;left:-9999em;top:-9999em;border:none 0;background:transparent",B="width:100%;height:100%;border:none 0";if(s===false){var F=+new Date,D=G.replace(/([?&])_=[^&]*/,"$1_="+F);G=D+((D===G)?(/\?/.test(G)?"&":"?")+"_="+F:"")}var A=function(){var K,J,L=u.content.find(".aui_loading"),H=r.config;n.addClass("aui_state_full");L&&L.hide();try{z=x.contentWindow;o=a(z.document);w=z.document.body}catch(I){x.style.cssText=B;H.follow?r.follow(H.follow):r.position(H.left,H.top);C.init&&C.init.call(r,z,E);C.init=null;return}K=H.width==="auto"?o.width()+(c?0:parseInt(a(w).css("marginLeft"))):H.width;J=H.height==="auto"?o.height():H.height;setTimeout(function(){x.style.cssText=B},0);r.size(K,J);H.follow?r.follow(H.follow):r.position(H.left,H.top);C.init&&C.init.call(r,z,E);C.init=null};var t={zIndex:j(),init:function(){r=this;u=r.DOM;q=u.main;n=u.content;x=r.iframe=E.document.createElement("iframe");x.src=G;x.name="Open"+r.config.id;x.style.cssText=y;x.setAttribute("frameborder",0,0);x.setAttribute("allowTransparency",true);p=a(x);r.content().appendChild(x);z=x.contentWindow;try{z.name=x.name;k.data(x.name+d,r);k.data(x.name+e,m)}catch(H){}p.bind("load",A)},close:function(){p.css("display","none").unbind("load",A);if(C.close&&C.close.call(this,x.contentWindow,E)===false){return false}n.removeClass("aui_state_full");p[0].src="about:blank";p.remove();try{k.removeData(x.name+d);k.removeData(x.name+e)}catch(H){}}};if(typeof C.ok==="function"){t.ok=function(){return C.ok.call(r,x.contentWindow,E)}}if(typeof C.cancel==="function"){t.cancel=function(){return C.cancel.call(r,x.contentWindow,E)}}delete C.content;for(var v in C){if(t[v]===l){t[v]=C[v]}}return f(t)};k.open.api=k.data(i+d);k.opener=k.data(i+e)||m;k.open.origin=k.opener;k.close=function(){var n=k.data(i+d);n&&n.close();return false};g!=m&&a(document).bind("mousedown",function(){var n=k.open.api;n&&n.zIndex()});k.load=function(s,r,n){n=n||false;var q=r||{};var o={zIndex:j(),init:function(v){var u=this,t=u.config;a.ajax({url:s,success:function(w){u.content(w);q.init&&q.init.call(u,v)},cache:n})}};delete r.content;for(var p in q){if(o[p]===l){o[p]=q[p]}}return f(o)};k.alert=function(o,n){return f({id:"Alert",zIndex:j(),icon:"warning",fixed:true,lock:true,content:o,ok:true,close:n})};k.confirm=function(n,p,o){return f({id:"Confirm",zIndex:j(),icon:"question",fixed:true,lock:true,opacity:0.1,content:n,ok:function(q){return p.call(this,q)},cancel:function(q){return o&&o.call(this,q)}})};k.prompt=function(n,q,p){p=p||"";var o;return f({id:"Prompt",zIndex:j(),icon:"question",fixed:true,lock:true,opacity:0.1,content:['<div style="margin-bottom:5px;font-size:12px">',n,"</div>","<div>",'<input value="',p,'" style="width:18em;padding:6px 4px" />',"</div>"].join(""),init:function(){o=this.DOM.content.find("input")[0];o.select();o.focus()},ok:function(r){return q&&q.call(this,o.value,r)},cancel:true})};k.tips=function(n,o){return f({id:"Tips",zIndex:j(),title:false,cancel:false,fixed:true,lock:false}).content('<div style="padding: 0 1em;">'+n+"</div>").time(o||1.5)};a(function(){var q=k.dragEvent;if(!q){return}var o=a(m),n=a(document),s=c?"absolute":"fixed",p=q.prototype,r=document.createElement("div"),t=r.style;t.cssText="display:none;position:"+s+";left:0;top:0;width:100%;height:100%;cursor:move;filter:alpha(opacity=0);opacity:0;background:#FFF";document.body.appendChild(r);p._start=p.start;p._end=p.end;p.start=function(){var u=k.focus.DOM,w=u.main[0],v=u.content[0].getElementsByTagName("iframe")[0];p._start.apply(this,arguments);t.display="block";t.zIndex=k.defaults.zIndex+3;if(s==="absolute"){t.width=o.width()+"px";t.height=o.height()+"px";t.left=n.scrollLeft()+"px";t.top=n.scrollTop()+"px"}if(v&&w.offsetWidth*w.offsetHeight>307200){w.style.visibility="hidden"}};p.end=function(){var u=k.focus;p._end.apply(this,arguments);t.display="none";if(u){u.DOM.main[0].style.visibility="visible"}}})})(this.art||this.jQuery,this,this.artDialog);